cases  - strings
case18846STONString
	^ 'FogBugzCase{#id:18846,#tags:OrderedCollection[''sprint'',''Validated in 60167'',''Validated in 60168'',''Validated in 60169''],#title:''<script:> and <script> pragmas do not always work '',#events:OrderedCollection[FogBugzEvent{#id:171017,#attachements:Set[],#description:''Opened by Alexandre Bergel'',#comment:''If you have a method like:\nfoo\n\t<script: \''self new foo inspect\''>\n\t\n\nIt is decorated in Nautilus with a button, you can press on it to execute the expression provided to script:. I personally use it all the time. \nHowever, time to time, this does not work. Frustrating.'',#date:DateAndTime[''2016-07-29T13:39:47+00:00''],#case:FogBugzCase{#id:18846,#subcases:[]},#user:FogBugzUser{#id:166,#username:''Alexandre Bergel''}},FogBugzEvent{#id:171018,#attachements:Set[],#description:''Assigned to Everyone by Alexandre Bergel'',#comment:'''',#date:DateAndTime[''2016-07-29T13:39:48+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171019,#attachements:Set[],#description:''Edited by Alexandre Bergel'',#comment:'''',#changes:''Milestone changed from \''Later\'' to \''Pharo6.0: 31/03/2017\''.\r\nAdded tag \''sprint\''.'',#date:DateAndTime[''2016-07-29T13:40:44+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171031,#attachements:Set[],#description:''Edited by Alexandre Bergel'',#comment:''Apparently, the problem comes from the IconicButton, which represents the small button next to the method name. Adding:\n   Halt if: [ actionSelector = #runScript ].\nin the method IconicButton(SimpleButtonMorph)>>doButtonAction\nallow me to open a debugger before the script is actually executed.\nThe problem is that the target variable is nil in the IconButton. Target should have a reference to MethodIsScriptWithArgumentAction.\n\nNow, I am trying to understand why the target variable does not hold a MethodIsScriptWithArgumentAction.\nMethodIsScriptWithArgumentAction has to direct reference, so that class is looked up using reflection.\n\nI am now investigating how the iconic button is created, since I have the impression that the target is not correctly \nMethodIsScriptAction >> privateActionIcon\nself haltOnce.\n\t ^IconicButton new \n\t\t\ttarget: self;\n\t\t\tactionSelector: #runScript;\n\t\t\tlabelGraphic: (Smalltalk ui icons scriptManagerIcon) ;\n\t\t\tcolor: Color transparent;\n\t\t\textent: self iconExtent;\n\t\t\thelpText: \''Run the script(s)\'';\n\t\t\tborderWidth: 0 '',#date:DateAndTime[''2016-07-29T15:02:57+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171032,#attachements:Set[],#description:''Edited by Alexandre Bergel'',#comment:''The following script indicates whether the problem is present:\n(IconicButton allInstances select: [ :t | t target isNil and: [ t actionSelector = #runScript ] ]) collect: #pointersTo.\n'',#date:DateAndTime[''2016-07-29T15:03:19+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171038,#attachements:Set[],#description:''Edited by Alexandre Bergel'',#comment:''We are close to fix the problem.\nConsider the following script:\n\n\"We create a method that we can play with\"\nASTCache compile: \''foo <script: \''\''self new\''\''>\''.\n\n\"We reset all the icons\"\nMethodWidget resetMethodIconCache.\n\n\"Evaluate this expression several time. The first time it returns a MethodIsScriptWithArgumentAction. The second time it returns nil\"\n(MethodWidget new methodIconFor: ( ASTCache >> #foo)) target.\n\nThe reason that the last expression returns nil, is that there is a WeakArray kept in the IconicButton. It is a weak array because for most of the action (i.e., subclass of AbstractMethodIconAction) the target refers to NautilusUI. But in the case of using <script:> or <script>, the target is a MethodIsScriptWithArgumentAction. It should therefore not be nil\nÂ '',#date:DateAndTime[''2016-07-29T16:03:19+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171040,#attachements:Set[],#description:''Edited by Alexandre Bergel'',#comment:''Name: SLICE-Issue-18846-script-and-script-pragmas-do-not-always-work--AlexandreBergel.1\nAuthor: AlexandreBergel\nTime: 29 July 2016, 12:04:18.758941 pm\nUUID: b8c84bad-aa8c-4e76-b118-105e991edbd6\nAncestors: \nDependencies: Nautilus-AlexandreBergel.1277, Nautilus-Tests-AlexandreBergel.38, NautilusCommon-AlexandreBergel.308\n\nWe finally got it. Was really not easy to fix. \nThanks to Milton Mamani and Alejandro Infante'',#date:DateAndTime[''2016-07-29T16:07:31+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171041,#attachements:Set[],#description:''Resolved (Fix Review Needed) and assigned to Alexandre Bergel by Alexandre Bergel'',#comment:'''',#changes:''Status changed from \''Work Needed\'' to \''Resolved (Fix Review Needed)\''.'',#date:DateAndTime[''2016-07-29T16:07:39+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171042,#attachements:Set[],#description:''Resolved (Monkey is checking) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:'''',#changes:''Status changed from \''Resolved (Fix Review Needed)\'' to \''Resolved (Monkey is checking)\''.'',#date:DateAndTime[''2016-07-29T16:08:09+00:00''],#case:@9,#user:FogBugzUser{#id:16,#username:''Ulysse The Galactic Monkey From Outer Space''}},FogBugzEvent{#id:171056,#attachements:Set[],#description:''Resolved (Fix Review Needed) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:''Check seems to be stuck. I will try it again'',#changes:''Status changed from \''Resolved (Monkey is checking)\'' to \''Resolved (Fix Review Needed)\''.'',#date:DateAndTime[''2016-07-29T18:17:08+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171057,#attachements:Set[],#description:''Resolved (Monkey is checking) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:'''',#changes:''Status changed from \''Resolved (Fix Review Needed)\'' to \''Resolved (Monkey is checking)\''.'',#date:DateAndTime[''2016-07-29T18:23:07+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171058,#attachements:Set[],#description:''Assigned to Everyone by Ulysse The Galactic Monkey From Outer Space'',#comment:''Issue Validation Failed: https://ci.inria.fr/pharo/job/Pharo-6.0-Issue-Validator/6957//artifact/validationReport.html\nErrors: 1 | '',#changes:''Status changed from \''Resolved (Monkey is checking)\'' to \''Work Needed\''.'',#date:DateAndTime[''2016-07-29T18:23:09+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171529,#attachements:Set[],#description:''Resolved (Fix Review Needed) and assigned to Alexandre Bergel by Nicolai Hess'',#comment:''try again'',#changes:''Status changed from \''Work Needed\'' to \''Resolved (Fix Review Needed)\''.'',#date:DateAndTime[''2016-08-03T20:28:48+00:00''],#case:@9,#user:FogBugzUser{#id:46,#username:''Nicolai Hess''}},FogBugzEvent{#id:171531,#attachements:Set[],#description:''Resolved (Monkey is checking) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:'''',#changes:''Status changed from \''Resolved (Fix Review Needed)\'' to \''Resolved (Monkey is checking)\''.'',#date:DateAndTime[''2016-08-03T20:53:08+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171534,#attachements:Set[],#description:''Resolved (Fix Reviewed by the Monkey) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:''Issue Validation Succeeded: https://ci.inria.fr/pharo/job/Pharo-6.0-Issue-Validator/7447//artifact/validationReport.html\r\n'',#changes:''Status changed from \''Resolved (Monkey is checking)\'' to \''Resolved (Fix Reviewed by the Monkey)\''.\r\nAdded tag \''Validated in 60167\''.'',#date:DateAndTime[''2016-08-03T21:10:10+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171535,#attachements:Set[],#description:''Edited by Nicolai Hess'',#comment:''Wouldn\''t it be easier to not cache the icon at all (do not use IconStateHolder if the target argument isn\''t the browser), by implementing\n\nactionStateToCache\n\t\"Return the state of the icon for caching purpose\"\n\t\n\t^ icon\n\non class MethodIsScriptAction\n'',#changes:''Notified Alexandre Bergel.'',#date:DateAndTime[''2016-08-03T21:13:35+00:00''],#case:@9,#user:@49},FogBugzEvent{#id:171536,#attachements:Set[],#description:''Edited by Alexandre Bergel'',#comment:''I thought about that. But we would not use the cache then. Why, do you feel our fix is unnecessary complex?'',#date:DateAndTime[''2016-08-03T21:19:50+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171588,#attachements:Set[],#description:''Resolved (Monkey is checking) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:'''',#changes:''Status changed from \''Resolved (Fix Reviewed by the Monkey)\'' to \''Resolved (Monkey is checking)\''.'',#date:DateAndTime[''2016-08-04T08:38:09+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171590,#attachements:Set[],#description:''Resolved (Fix Reviewed by the Monkey) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:''Issue Validation Succeeded: https://ci.inria.fr/pharo/job/Pharo-6.0-Issue-Validator/7494//artifact/validationReport.html\r\n'',#changes:''Status changed from \''Resolved (Monkey is checking)\'' to \''Resolved (Fix Reviewed by the Monkey)\''.\r\nAdded tag \''Validated in 60168\''.'',#date:DateAndTime[''2016-08-04T08:55:45+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171630,#attachements:Set[],#description:''Edited by Nicolai Hess'',#comment:''I am sorry, I didn\''t meant, to not cache the Icon, but to not use IconicButtonStateHolder for the cached Icon.\n\nI don\''t like the other solution, because we use \nIconicButtonStateHolder just for the purpose to *not* hold a strong reference to the target (see class comment). It is a little bit confusing if we now add a method yet to make again a strong reference.\n\nSo, instead of creating a IconicButtonStateHolder in actionStateToCache, I would just return the Icon(icButton).'',#changes:''Notified Alexandre Bergel.'',#date:DateAndTime[''2016-08-04T13:49:17+00:00''],#case:@9,#user:@49},FogBugzEvent{#id:171653,#attachements:Set[],#description:''Resolved (Monkey is checking) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:'''',#changes:''Status changed from \''Resolved (Fix Reviewed by the Monkey)\'' to \''Resolved (Monkey is checking)\''.'',#date:DateAndTime[''2016-08-04T15:08:11+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171657,#attachements:Set[],#description:''Resolved (Fix Reviewed by the Monkey) and assigned to Alexandre Bergel by Ulysse The Galactic Monkey From Outer Space'',#comment:''Issue Validation Succeeded: https://ci.inria.fr/pharo/job/Pharo-6.0-Issue-Validator/7520//artifact/validationReport.html\r\n'',#changes:''Status changed from \''Resolved (Monkey is checking)\'' to \''Resolved (Fix Reviewed by the Monkey)\''.\r\nAdded tag \''Validated in 60169\''.'',#date:DateAndTime[''2016-08-04T15:25:59+00:00''],#case:@9,#user:@36},FogBugzEvent{#id:171661,#attachements:Set[],#description:''Edited by Alexandre Bergel'',#comment:''Good point!\n\nI have committed a SLICE-Issue-18846-script-and-script-pragmas-do-not-always-work--AlexandreBergel.2\nin the Pharo60Inbox\n\nLooks like it is now ready to be included'',#date:DateAndTime[''2016-08-04T16:38:55+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171662,#attachements:Set[],#description:''Reactivated (assigned to Everyone) by Alexandre Bergel'',#comment:'''',#changes:''Status changed from \''Resolved (Fix Reviewed by the Monkey)\'' to \''Work Needed\''.'',#date:DateAndTime[''2016-08-04T16:39:17+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171663,#attachements:Set[],#description:''Resolved (Fix Review Needed) and assigned to Alexandre Bergel by Alexandre Bergel'',#comment:'''',#changes:''Status changed from \''Work Needed\'' to \''Resolved (Fix Review Needed)\''.'',#date:DateAndTime[''2016-08-04T16:39:30+00:00''],#case:@9,#user:@11},FogBugzEvent{#id:171684,#attachements:Set[],#description:''Assigned to Alexandre Bergel by Nicolai Hess'',#comment:''OK!'',#changes:''Status changed from \''Resolved (Fix Review Needed)\'' to \''Resolved (Fix To Include)\''.'',#date:DateAndTime[''2016-08-04T20:53:25+00:00''],#case:@9,#user:@49}],#milestone:''Pharo6.0'',#lastModification:DateAndTime[''2016-08-04T20:53:25+00:00''],#dateOpened:DateAndTime[''2016-07-29T13:39:47+00:00''],#dateResolved:DateAndTime[''2016-08-04T16:39:30+00:00''],#status:''Resolved (Fix To Include)'',#subcases:@10,#user:@11,#configuration:'''',#configurationVersion:'''',#preload:'''',#postload:''''}'